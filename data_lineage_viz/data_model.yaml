nodes:
  - name: Catalog_input
    layer: SharePoint
    type: Excel
    comment: "Основной справочник материалов."
    sheets:
      - name: Main
        columns:
          - { name: LOT, link: "Merged_Spool_Data.LOT", comment: "ключ LOT" }
          - { name: MFZ, link: "Merged_Spool_Data.MFZ", comment: "зона сборки" }

  - name: Saved_progress
    layer: SharePoint
    type: Excel
    comment: "Статусы из SharePoint."
    sheets:
      - name: Progress
        columns:
          - { name: LOT, link: "Merged_Spool_Data.LOT", comment: "ключ связи" }
          - { name: Progress_Status, link: "Merged_Spool_Data.Progress_Status", comment: "merge по LOT" }

  - name: Merged_Spool_Data
    layer: PowerQuery
    type: Table
    comment: "Основная таблица Power Query."
    sheets:
      - name: Root
        columns:
          - { name: LOT, link: "Catalog_input.LOT", comment: "объединение по LOT" }
          - { name: MFZ, link: "Catalog_input.MFZ", comment: "взято из Catalog_input" }
          - { name: Progress_Status, link: "Saved_progress.Progress_Status", comment: "merge join" }

  - name: Transfer_Orders
    layer: Output
    type: Report
    comment: "Финальный отчёт."
    sheets:
      - name: Out
        columns:
          - { name: LOT, link: "Merged_Spool_Data.LOT", comment: "" }
          - { name: Warehouse, link: "", comment: "" }
          - { name: Date, link: "", comment: "" }

edges:
  - from: Catalog_input
    to: Merged_Spool_Data
    type: normal
    transfer:
      - [LOT, "LOT → Merged_Spool_Data.LOT"]
      - [MFZ, "MFZ → Merged_Spool_Data.MFZ"]

  - from: Saved_progress
    to: Merged_Spool_Data
    type: normal_bar
    transfer:
      - [LOT, "LOT → Merged_Spool_Data.LOT"]
      - [Progress_Status, "Progress_Status → Merged_Spool_Data.Progress_Status"]

  - from: Merged_Spool_Data
    to: Transfer_Orders
    type: manual
    transfer:
      - [LOT, "LOT → Transfer_Orders.LOT"]
      - [Warehouse, "формируется вручную"]

  - from: Saved_progress
    to: Transfer_Orders
    type: planned

  - from: Merged_Spool_Data
    to: Saved_progress
    type: normal_bar
