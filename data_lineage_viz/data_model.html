<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Data Model Visualization</title>
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<style>
  body {
    margin: 0;
    display: flex;
    height: 100vh;
    overflow: hidden;
    background: #111;
    color: #f5f5f5;
    font-family: "Segoe UI", sans-serif;
  }
  #mynetwork {
    flex: 2;
    border-right: 2px solid #222;
    background: radial-gradient(circle at 50% 50%, #151515 0%, #0b0b0b 80%);
  }
  #details {
    flex: 1;
    background: #141414;
    box-shadow: inset 0 0 25px rgba(0,0,0,0.6);
    padding: 20px;
    overflow-y: auto;
    transition: all 0.3s ease;
  }
  h3 { margin-top: 0; color: #58a6ff; }
  table {
    border-collapse: collapse; width: 100%; margin-top: 10px; font-size: 13px; background: #1e1e1e;
  }
  th, td { border: 1px solid #333; padding: 6px 8px; text-align: left; color: #ddd; }
  th { background: #222; color: #ffdf6b; position: sticky; top: 0; }
  tr:hover td { background: #2b2b2b; }
  .comment { color: #aaa; font-style: italic; }
</style>
</head>
<body>
  <div id="mynetwork"></div>
  <div id="details">
    <h3>üìã –î–µ—Ç–∞–ª–∏</h3>
    <div id="table-info"><p style="color:#888">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —É–∑–µ–ª –∏–ª–∏ —Å—Ç—Ä–µ–ª–∫—É</p></div>
  </div>

  <script id="NODE_DATA" type="application/json">{"Catalog_input": {"layer": "SharePoint", "type": "Excel", "comment": "–û—Å–Ω–æ–≤–Ω–æ–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.", "columns": [{"Sheet": "Main", "Column": "LOT", "Link": "Merged_Spool_Data.LOT", "Comment": "–∫–ª—é—á LOT"}, {"Sheet": "Main", "Column": "MFZ", "Link": "Merged_Spool_Data.MFZ", "Comment": "–∑–æ–Ω–∞ —Å–±–æ—Ä–∫–∏"}]}, "Saved_progress": {"layer": "SharePoint", "type": "Excel", "comment": "–°—Ç–∞—Ç—É—Å—ã –∏–∑ SharePoint.", "columns": [{"Sheet": "Progress", "Column": "LOT", "Link": "Merged_Spool_Data.LOT", "Comment": "–∫–ª—é—á —Å–≤—è–∑–∏"}, {"Sheet": "Progress", "Column": "Progress_Status", "Link": "Merged_Spool_Data.Progress_Status", "Comment": "merge –ø–æ LOT"}]}, "Merged_Spool_Data": {"layer": "PowerQuery", "type": "Table", "comment": "–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ Power Query.", "columns": [{"Sheet": "Root", "Column": "LOT", "Link": "Catalog_input.LOT", "Comment": "–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ LOT"}, {"Sheet": "Root", "Column": "MFZ", "Link": "Catalog_input.MFZ", "Comment": "–≤–∑—è—Ç–æ –∏–∑ Catalog_input"}, {"Sheet": "Root", "Column": "Progress_Status", "Link": "Saved_progress.Progress_Status", "Comment": "merge join"}]}, "Transfer_Orders": {"layer": "Output", "type": "Report", "comment": "–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç.", "columns": [{"Sheet": "Out", "Column": "LOT", "Link": "Merged_Spool_Data.LOT", "Comment": ""}, {"Sheet": "Out", "Column": "Warehouse", "Link": "", "Comment": ""}, {"Sheet": "Out", "Column": "Date", "Link": "", "Comment": ""}]}}</script>
  <script id="VIS_NODES" type="application/json">[{"id": "Catalog_input", "label": "Catalog_input\n(SharePoint)", "group": "SharePoint"}, {"id": "Saved_progress", "label": "Saved_progress\n(SharePoint)", "group": "SharePoint"}, {"id": "Merged_Spool_Data", "label": "Merged_Spool_Data\n(PowerQuery)", "group": "PowerQuery"}, {"id": "Transfer_Orders", "label": "Transfer_Orders\n(Output)", "group": "Output"}]</script>
  <script id="VIS_EDGES" type="application/json">[{"from": "Catalog_input", "to": "Merged_Spool_Data", "arrows": {"to": {"enabled": true, "type": "arrow", "scaleFactor": 0.7}}, "color": "rgba(180,180,180,1)", "dashes": false, "type": "normal", "transfer": [["LOT", "LOT ‚Üí Merged_Spool_Data.LOT"], ["MFZ", "MFZ ‚Üí Merged_Spool_Data.MFZ"]]}, {"from": "Saved_progress", "to": "Merged_Spool_Data", "arrows": {"to": {"enabled": true, "type": "bar", "scaleFactor": 0.7}}, "color": "rgba(180,180,180,1)", "dashes": false, "type": "normal_bar", "transfer": [["LOT", "LOT ‚Üí Merged_Spool_Data.LOT"], ["Progress_Status", "Progress_Status ‚Üí Merged_Spool_Data.Progress_Status"]]}, {"from": "Merged_Spool_Data", "to": "Transfer_Orders", "arrows": {"to": {"enabled": true, "type": "arrow", "scaleFactor": 0.7}}, "color": "rgba(255,223,107,1)", "dashes": true, "type": "manual", "transfer": [["LOT", "LOT ‚Üí Transfer_Orders.LOT"], ["Warehouse", "—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é"]]}, {"from": "Saved_progress", "to": "Transfer_Orders", "arrows": {"to": {"enabled": true, "type": "arrow", "scaleFactor": 0.7}}, "color": "rgba(150,150,150,0.25)", "dashes": false, "type": "planned", "transfer": []}, {"from": "Merged_Spool_Data", "to": "Saved_progress", "arrows": {"to": {"enabled": true, "type": "bar", "scaleFactor": 0.7}}, "color": "rgba(180,180,180,1)", "dashes": false, "type": "normal_bar", "transfer": []}]</script>

  <script>
    const nodeData = JSON.parse(document.getElementById("NODE_DATA").textContent);
    const visNodesRaw = JSON.parse(document.getElementById("VIS_NODES").textContent);
    const visEdgesRaw = JSON.parse(document.getElementById("VIS_EDGES").textContent);
    const nodes = new vis.DataSet(visNodesRaw);
    const edges = new vis.DataSet(visEdgesRaw);

    const container = document.getElementById("mynetwork");
    const network = new vis.Network(container, { nodes, edges }, {
      physics: { stabilization: false, barnesHut: { gravitationalConstant: -4500, springLength: 160 } },
      interaction: { hover: true },
      nodes: {
        shape: "box",
        font: { color: "#fff", size: 14 },
        borderWidth: 1,
        margin: 10,
        shapeProperties: { borderRadius: 8 }
      },
      edges: {
        smooth: { type: "cubicBezier", roundness: 0.35 },
        width: 1.4
      }
    });

    const infoDiv = document.getElementById("table-info");

    network.on("click", function (params) {
      if (params.nodes.length > 0) {
        const id = params.nodes[0];
        const data = nodeData[id];
        if (!data) return;
        const rows = (data.columns || []).map(c =>
          `<tr><td>${c.Sheet}</td><td>${c.Column}</td><td>${c.Link}</td><td>${c.Comment}</td></tr>`
        ).join("");
        infoDiv.innerHTML = `
          <h4>${id}</h4>
          <p><b>Layer:</b> ${data.layer} | <b>Type:</b> ${data.type}</p>
          <p class="comment">${data.comment}</p>
          <table>
            <tr><th>Sheet</th><th>Column</th><th>Link</th><th>Comment</th></tr>${rows}
          </table>`;
      } else if (params.edges.length > 0) {
        const e = edges.get(params.edges[0]);
        const transfer = e.transfer || [];
        let html = `<h4>${e.from} ‚Üí ${e.to}</h4>`;
        if (transfer.length === 0) {
          html += "<p>–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–µ—Ä–µ–¥–∞—á–µ –¥–∞–Ω–Ω—ã—Ö.</p>";
        } else {
          html += `<table><tr><th>–ü–æ–ª–µ</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>`;
          transfer.forEach(t => { html += `<tr><td>${t[0]}</td><td>${t[1]}</td></tr>`; });
          html += `</table>`;
        }
        infoDiv.innerHTML = html;
      }
    });
  </script>
</body>
</html>
