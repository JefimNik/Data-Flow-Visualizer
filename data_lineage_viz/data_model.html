<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Data Model Visualization</title>
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<style>
  body {
    margin: 0; padding: 0;
    display: flex; height: 100vh; overflow: hidden;
    background: radial-gradient(circle at 40% 40%, #1a1a1a 0%, #0d0d0d 70%);
    color: #f5f5f5;
    font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }
  #mynetwork {
    flex: 2;
    border-right: 2px solid #222;
    background: radial-gradient(circle at 50% 50%, #151515 0%, #0b0b0b 80%);
  }
  #details {
    flex: 1;
    background: #141414;
    box-shadow: inset 0 0 25px rgba(0,0,0,0.6);
    padding: 20px;
    overflow-y: auto;
    transition: all 0.3s ease;
  }
  #details.hidden { transform: translateX(100%); opacity: 0; }
  h3 { margin-top: 0; color: #58a6ff; }
  h4 { margin-bottom: 6px; color: #7fdfff; }
  table {
    border-collapse: collapse; width: 100%; margin-top: 10px;
    font-size: 13px; background: #1e1e1e;
  }
  th, td {
    border: 1px solid #333; padding: 6px 8px; text-align: left; color: #ddd;
  }
  th {
    background: #222; color: #ffdf6b; position: sticky; top: 0; z-index: 1;
  }
  tr:hover td { background: #2b2b2b; }
  .comment { color: #bbb; font-style: italic; }
</style>
</head>
<body>
  <div id="mynetwork"></div>
  <div id="details" class="hidden">
    <h3>üìã Table details</h3>
    <div id="table-info"><p style="color:#888">Click a node to see details.</p></div>
  </div>

  <!-- JSON containers -->
  <script id="NODE_DATA" type="application/json">{"Catalog_input": {"layer": "SharePoint", "type": "Excel", "comment": "–û—Å–Ω–æ–≤–Ω–æ–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.", "columns": [{"Sheet": "Main", "Column": "LOT", "Link": "Merged_Spool_Data.LOT", "Comment": "–∫–ª—é—á LOT"}, {"Sheet": "Main", "Column": "MFZ", "Link": "Merged_Spool_Data.MFZ", "Comment": "–∑–æ–Ω–∞ —Å–±–æ—Ä–∫–∏"}, {"Sheet": "Main", "Column": "DN", "Link": "", "Comment": "–¥–∏–∞–º–µ—Ç—Ä"}]}, "Saved_progress": {"layer": "SharePoint", "type": "Excel", "comment": "–°—Ç–∞—Ç—É—Å—ã –∏–∑ SharePoint.", "columns": [{"Sheet": "Progress", "Column": "LOT", "Link": "Merged_Spool_Data.LOT", "Comment": "–∫–ª—é—á —Å–≤—è–∑–∏"}, {"Sheet": "Progress", "Column": "Progress_Status", "Link": "Merged_Spool_Data.Progress_Status", "Comment": "merge –ø–æ LOT"}]}, "Merged_Spool_Data": {"layer": "PowerQuery", "type": "Table", "comment": "–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ Power Query.", "columns": [{"Sheet": "Root", "Column": "LOT", "Link": "Catalog_input.LOT", "Comment": "–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ LOT"}, {"Sheet": "Root", "Column": "MFZ", "Link": "Catalog_input.MFZ", "Comment": "–≤–∑—è—Ç–æ –∏–∑ Catalog_input"}, {"Sheet": "Root", "Column": "Progress_Status", "Link": "Saved_progress.Progress_Status", "Comment": "merge join"}]}, "Transfer_Orders": {"layer": "Output", "type": "Report", "comment": "–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç.", "columns": [{"Sheet": "Out", "Column": "LOT", "Link": "Merged_Spool_Data.LOT", "Comment": ""}, {"Sheet": "Out", "Column": "Warehouse", "Link": "", "Comment": ""}, {"Sheet": "Out", "Column": "Date", "Link": "", "Comment": ""}]}}</script>
  <script id="VIS_NODES" type="application/json">[{"id": "Catalog_input", "label": "Catalog_input\n(SharePoint)", "group": "SharePoint"}, {"id": "Saved_progress", "label": "Saved_progress\n(SharePoint)", "group": "SharePoint"}, {"id": "Merged_Spool_Data", "label": "Merged_Spool_Data\n(PowerQuery)", "group": "PowerQuery"}, {"id": "Transfer_Orders", "label": "Transfer_Orders\n(Output)", "group": "Output"}]</script>
  <script id="VIS_EDGES" type="application/json">[{"from": "Catalog_input", "to": "Merged_Spool_Data", "arrows": "to"}, {"from": "Saved_progress", "to": "Merged_Spool_Data", "arrows": "to"}, {"from": "Merged_Spool_Data", "to": "Transfer_Orders", "arrows": "to"}]</script>

  <script>
    const nodeData = JSON.parse(document.getElementById("NODE_DATA").textContent);
    const visNodesRaw = JSON.parse(document.getElementById("VIS_NODES").textContent);
    const visEdgesRaw = JSON.parse(document.getElementById("VIS_EDGES").textContent);

    const nodes = new vis.DataSet(visNodesRaw);
    const edges = new vis.DataSet(visEdgesRaw);

    const network = new vis.Network(
      document.getElementById("mynetwork"),
      { nodes, edges },
      {
        physics: {
          stabilization: false,
          barnesHut: { gravitationalConstant: -4500, centralGravity: 0.25, springLength: 160 }
        },
        interaction: { hover: true },
        nodes: {
          shape: "box",
          font: { color: "#ffffff", size: 14, multi: true, face: "Segoe UI" },
          borderWidth: 1,
          margin: 10,
          shapeProperties: { borderRadius: 8 },
          shadow: { enabled: true, size: 5, color: "rgba(0,0,0,0.4)" }
        },
        edges: {
          color: { color: "#777", highlight: "#58a6ff" },
          smooth: { type: "cubicBezier", roundness: 0.35 },
          arrows: { to: { enabled: true, scaleFactor: 0.7 } },
          width: 1.3
        },
        groups: {
          SharePoint: {
            color: { background: "#E8C973", border: "#8a6d16", highlight: { background: "#E8C973", border: "#fff1b2" },
             hover: { background: "#FFF0B8", border: "#fff6b0" }},
            font: { color: "#8C6D17" }
          },
          PowerQuery: {
            color: { background: "#1e5ba8", border: "#15437c", highlight: { background: "#3476c8", border: "#b3d3ff" } },
            font: { color: "#fff" }
          },
          Output: {
            color: { background: "#20723b", border: "#17582d", highlight: { background: "#2b8e4a", border: "#a8f0b8" } },
            font: { color: "#fff" }
          }
        }
      }
    );

    // –ü–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫ (\n)
    nodes.get().forEach(n => {
      if (typeof n.label === "string" && n.label.includes("\\\\n")) {
        nodes.update({ id: n.id, label: n.label.replace(/\\\\n/g, "\n") });
      }
    });

    const detailPanel = document.getElementById("details");
    const infoDiv = document.getElementById("table-info");

    network.on("click", function (params) {
      if (params.nodes.length > 0) {
        const nodeId = params.nodes[0];
        const data = nodeData[nodeId];
        if (!data) return;
        detailPanel.classList.remove("hidden");
        const rows = (data.columns || []).map(c =>
          `<tr><td>${c.Sheet || ""}</td><td>${c.Column || ""}</td><td>${c.Link || ""}</td><td>${c.Comment || ""}</td></tr>`
        ).join("");
        infoDiv.innerHTML = `
          <h4>${nodeId}</h4>
          <p><b>Layer:</b> ${data.layer || ""} &nbsp; | &nbsp; <b>Type:</b> ${data.type || ""}</p>
          <p class="comment">${data.comment || ""}</p>
          <table>
            <tr><th>Sheet</th><th>Column</th><th>Link</th><th>Comment</th></tr>
            ${rows}
          </table>`;
      }
    });

    network.on("deselectNode", () => detailPanel.classList.add("hidden"));
  </script>
</body>
</html>
