<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Data Model Visualization</title>
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<style>
  body {
    margin: 0; padding: 0;
    display: flex; height: 100vh; overflow: hidden;
    background: radial-gradient(circle at 40% 40%, #1a1a1a 0%, #0d0d0d 70%);
    color: #f5f5f5;
    font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }
  #mynetwork {
    flex: 2;
    border-right: 2px solid #222;
    background: radial-gradient(circle at 50% 50%, #151515 0%, #0b0b0b 80%);
  }
  #details {
    flex: 1;
    background: #141414;
    box-shadow: inset 0 0 25px rgba(0,0,0,0.6);
    padding: 20px;
    overflow-y: auto;
    transition: all 0.3s ease;
  }
  #details.hidden { transform: translateX(100%); opacity: 0; }
  h3 { margin-top: 0; color: #58a6ff; }
  h4 { margin-bottom: 6px; color: #7fdfff; }
  table {
    border-collapse: collapse; width: 100%; margin-top: 10px;
    font-size: 13px; background: #1e1e1e;
  }
  th, td {
    border: 1px solid #333; padding: 6px 8px; text-align: left; color: #ddd;
  }
  th {
    background: #222; color: #ffdf6b; position: sticky; top: 0; z-index: 1;
  }
  tr:hover td { background: #2b2b2b; }
  .comment { color: #bbb; font-style: italic; }
</style>
</head>
<body>
  <div id="mynetwork"></div>
  <div id="details" class="hidden">
    <h3>ðŸ“‹ Table details</h3>
    <div id="table-info"><p style="color:#888">Click a node to see details.</p></div>
  </div>

  <script id="NODE_DATA" type="application/json">__NODE_DATA__</script>
  <script id="VIS_NODES" type="application/json">__VIS_NODES__</script>
  <script id="VIS_EDGES" type="application/json">__VIS_EDGES__</script>

  <script>
    const nodeData = JSON.parse(document.getElementById("NODE_DATA").textContent);
    const visNodesRaw = JSON.parse(document.getElementById("VIS_NODES").textContent);
    const visEdgesRaw = JSON.parse(document.getElementById("VIS_EDGES").textContent);

    const nodes = new vis.DataSet(visNodesRaw);
    const edges = new vis.DataSet(visEdgesRaw);

    const container = document.getElementById("mynetwork");
    const network = new vis.Network(container, { nodes, edges }, {
      physics: {
        stabilization: false,
        barnesHut: { gravitationalConstant: -4500, centralGravity: 0.25, springLength: 160 }
      },
      interaction: { hover: true },
      nodes: {
        shape: "box",
        font: { color: "#ffffff", size: 14, multi: true, face: "Segoe UI" },
        borderWidth: 1,
        margin: 10,
        shapeProperties: { borderRadius: 8 },
        shadow: { enabled: true, size: 5, color: "rgba(0,0,0,0.4)" }
      },
      edges: {
        smooth: { type: "cubicBezier", roundness: 0.35 },
        arrows: { to: { enabled: true, scaleFactor: 0.7 } },
        width: 1.4,
        shadow: { enabled: true, size: 3, color: "rgba(0,0,0,0.5)" }
      },
      groups: {
        SharePoint: { color: { background: "#b48c1d", border: "#8a6d16" }, font: { color: "#fff" } },
        PowerQuery: { color: { background: "#1e5ba8", border: "#15437c" }, font: { color: "#fff" } },
        Output: { color: { background: "#20723b", border: "#17582d" }, font: { color: "#fff" } }
      }
    });

    nodes.get().forEach(n => {
      if (typeof n.label === "string" && n.label.includes("\\\\n")) {
        nodes.update({ id: n.id, label: n.label.replace(/\\\\n/g, "\n") });
      }
    });

    const detailPanel = document.getElementById("details");
    const infoDiv = document.getElementById("table-info");

    network.on("click", function (params) {
      if (params.nodes.length > 0) {
        const nodeId = params.nodes[0];
        const data = nodeData[nodeId];
        if (!data) return;
        detailPanel.classList.remove("hidden");
        const rows = (data.columns || []).map(c =>
          `<tr><td>${c.Sheet || ""}</td><td>${c.Column || ""}</td><td>${c.Link || ""}</td><td>${c.Comment || ""}</td></tr>`
        ).join("");
        infoDiv.innerHTML = `
          <h4>${nodeId}</h4>
          <p><b>Layer:</b> ${data.layer || ""} &nbsp; | &nbsp; <b>Type:</b> ${data.type || ""}</p>
          <p class="comment">${data.comment || ""}</p>
          <table>
            <tr><th>Sheet</th><th>Column</th><th>Link</th><th>Comment</th></tr>
            ${rows}
          </table>`;
      }
    });

    network.on("deselectNode", () => detailPanel.classList.add("hidden"));
  </script>
</body>
</html>
