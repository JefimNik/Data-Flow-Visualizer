<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Data Model Visualization</title>
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<style>
  body {
    margin: 0;
    display: flex;
    height: 100vh;
    overflow: hidden;
    background: #111;
    color: #f5f5f5;
    font-family: "Segoe UI", sans-serif;
  }
  #mynetwork {
    flex: 2;
    border-right: 2px solid #222;
    background: radial-gradient(circle at 50% 50%, #151515 0%, #0b0b0b 80%);
  }
  #details {
    flex: 1;
    background: #141414;
    box-shadow: inset 0 0 25px rgba(0,0,0,0.6);
    padding: 20px;
    overflow-y: auto;
    transition: all 0.3s ease;
  }
  h3 { margin-top: 0; color: #58a6ff; }
  table {
    border-collapse: collapse; width: 100%; margin-top: 10px; font-size: 13px; background: #1e1e1e;
  }
  th, td { border: 1px solid #333; padding: 6px 8px; text-align: left; color: #ddd; }
  th { background: #222; color: #ffdf6b; position: sticky; top: 0; }
  tr:hover td { background: #2b2b2b; }
  .comment { color: #aaa; font-style: italic; }
</style>
</head>
<body>
  <div id="mynetwork"></div>
  <div id="details">
    <h3>üìã –î–µ—Ç–∞–ª–∏</h3>
    <div id="table-info"><p style="color:#888">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —É–∑–µ–ª –∏–ª–∏ —Å—Ç—Ä–µ–ª–∫—É</p></div>
  </div>

  <script id="NODE_DATA" type="application/json">__NODE_DATA__</script>
  <script id="VIS_NODES" type="application/json">__VIS_NODES__</script>
  <script id="VIS_EDGES" type="application/json">__VIS_EDGES__</script>

  <script>
    const nodeData = JSON.parse(document.getElementById("NODE_DATA").textContent);
    const visNodesRaw = JSON.parse(document.getElementById("VIS_NODES").textContent);
    const visEdgesRaw = JSON.parse(document.getElementById("VIS_EDGES").textContent);
    const nodes = new vis.DataSet(visNodesRaw);
    const edges = new vis.DataSet(visEdgesRaw);

    const container = document.getElementById("mynetwork");
    const network = new vis.Network(container, { nodes, edges }, {
      physics: { stabilization: false, barnesHut: { gravitationalConstant: -4500, springLength: 160 } },
      interaction: { hover: true },
      nodes: {
        shape: "box",
        font: { color: "#fff", size: 14 },
        borderWidth: 1,
        margin: 10,
        shapeProperties: { borderRadius: 8 }
      },
      edges: {
        smooth: { type: "cubicBezier", roundness: 0.35 },
        width: 1.4
      }
    });

    const infoDiv = document.getElementById("table-info");

    network.on("click", function (params) {
      if (params.nodes.length > 0) {
        const id = params.nodes[0];
        const data = nodeData[id];
        if (!data) return;
        const rows = (data.columns || []).map(c =>
          `<tr><td>${c.Sheet}</td><td>${c.Column}</td><td>${c.Link}</td><td>${c.Comment}</td></tr>`
        ).join("");
        infoDiv.innerHTML = `
          <h4>${id}</h4>
          <p><b>Layer:</b> ${data.layer} | <b>Type:</b> ${data.type}</p>
          <p class="comment">${data.comment}</p>
          <table>
            <tr><th>Sheet</th><th>Column</th><th>Link</th><th>Comment</th></tr>${rows}
          </table>`;
      } else if (params.edges.length > 0) {
        const e = edges.get(params.edges[0]);
        const transfer = e.transfer || [];
        let html = `<h4>${e.from} ‚Üí ${e.to}</h4>`;
        if (transfer.length === 0) {
          html += "<p>–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–µ—Ä–µ–¥–∞—á–µ –¥–∞–Ω–Ω—ã—Ö.</p>";
        } else {
          html += `<table><tr><th>–ü–æ–ª–µ</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>`;
          transfer.forEach(t => { html += `<tr><td>${t[0]}</td><td>${t[1]}</td></tr>`; });
          html += `</table>`;
        }
        infoDiv.innerHTML = html;
      }
    });
  </script>
</body>
</html>
